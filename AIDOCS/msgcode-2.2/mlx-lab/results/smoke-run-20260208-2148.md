# MLX Smoke Test Report

> Automated smoke test execution for MLX LM Server validation
>
> Generated: 2026-02-08 21:48:15

---

## Execution Summary

| Metric | Value |
|--------|-------|
| **Total Tests** | 5 |
| **Passed** | 3 |
| **Failed** | 2 |
| **Pass Rate** | 60% |

---

## Test Details


### Start MLX Server

| Field | Content |
|-------|---------|
| **Test Name** | Start MLX Server |
| **Script** | `start-server.sh` |
| **Rounds** | N/A |
| **Expected Behavior** | MLX server starts successfully and is ready to accept requests |
| **Status** | RUNNING |


**Result:** ✅ PASSED

```
启动 mlx_lm.server...
  模型路径: /Users/admin/Models/lmstudio/huihui-ai/Huihui-GLM-4.7-Flash-abliterated-mlx-4bit
  模型 ID: /Users/admin/Models/lmstudio/huihui-ai/Huihui-GLM-4.7-Flash-abliterated-mlx-4bit
  监听地址: 127.0.0.1:18003
  最大 tokens: 512
  Python venv: /Users/admin/GitProjects/msgcode/venv
等待服务启动...
等待 HTTP 就绪...

mlx_lm.server 启动成功!
  PID: 81741
  PID 文件: /tmp/msgcode-mlx-lab.pid
  日志文件: /tmp/msgcode-mlx-lab.log

建议：为避免 probe 脚本选错模型，先导出 MLX_MODEL_ID：
  export MLX_MODEL_ID="/Users/admin/Models/lmstudio/huihui-ai/Huihui-GLM-4.7-Flash-abliterated-mlx-4bit"

健康检查: curl http://127.0.0.1:18003/v1/models
停止服务: bash scripts/mlx-lab/stop-server.sh
```


### Health Check

| Field | Content |
|-------|---------|
| **Test Name** | Health Check |
| **Script** | `check-health.sh` |
| **Rounds** | N/A |
| **Expected Behavior** | Server /v1/models endpoint returns 200 and valid model list |
| **Status** | RUNNING |


**Result:** ✅ PASSED

```
检查服务健康状态: http://127.0.0.1:18003/v1/models

服务健康检查通过!
  HTTP 状态: 200
  可用模型数: 2

模型列表:
  - openbmb/MiniCPM-o-4_5
  - /Users/admin/Models/lmstudio/huihui-ai/Huihui-GLM-4.7-Flash-abliterated-mlx-4bit
```


### Basic Response Test

| Field | Content |
|-------|---------|
| **Test Name** | Basic Response Test |
| **Script** | `probe-basic.sh` |
| **Rounds** | 5 |
| **Expected Behavior** | 5 rounds of simple prompts, each returning valid response (expected: 'OK') |
| **Status** | RUNNING |


**Result:** ❌ FAILED

```
基础响应测试 (5 轮)
测试指令: 只输出 OK
参数: temperature=1.0 top_p=0.95 max_tokens=256

[1/5] 失败: '' (finish_reason=length)
[2/5] 通过: OK
[3/5] 通过: OK
[4/5] 通过: OK
[5/5] 通过: OK

结果: basic_pass = 4/5
状态: 失败
```

**Error Log:**
```
基础响应测试 (5 轮)
测试指令: 只输出 OK
参数: temperature=1.0 top_p=0.95 max_tokens=256

[1/5] 失败: '' (finish_reason=length)
[2/5] 通过: OK
[3/5] 通过: OK
[4/5] 通过: OK
[5/5] 通过: OK

结果: basic_pass = 4/5
状态: 失败
```


### Tool Role Test

| Field | Content |
|-------|---------|
| **Test Name** | Tool Role Test |
| **Script** | `probe-tool-role.sh` |
| **Rounds** | 10 |
| **Expected Behavior** | 10 rounds testing tool role message handling and context preservation |
| **Status** | RUNNING |


**Result:** ❌ FAILED

```
Tool Role 回灌测试 (10 轮)
测试: 模型应该只输出工具返回的值 (42)
参数: temperature=0.7 top_p=1 max_tokens=2048

[1/10] 通过: 42
[2/10] 
```

**Error Log:**
```
Tool Role 回灌测试 (10 轮)
测试: 模型应该只输出工具返回的值 (42)
参数: temperature=0.7 top_p=1 max_tokens=2048

[1/10] 通过: 42
[2/10] 
```


### Tool Loop Test

| Field | Content |
|-------|---------|
| **Test Name** | Tool Loop Test |
| **Script** | `probe-tool-loop.sh` |
| **Rounds** | 10 |
| **Expected Behavior** | 10 rounds testing two-round tool call loop (assistant → tool → assistant) |
| **Status** | RUNNING |


**Result:** ✅ PASSED

```
工具闭环测试 (10 轮)
测试: 模拟两轮工具调用闭环
参数: temperature=0.7 top_p=1 max_tokens=512

[1/10] 通过: 42
[2/10] 通过: 42
[3/10] 通过: 42
[4/10] 通过: 42
[5/10] 通过: 42
[6/10] 通过: 42
[7/10] 通过: 42
[8/10] 通过: 42
[9/10] 通过: 42
[10/10] 通过: 42

结果: tool_loop_pass = 10/10
状态: 通过
```


---

## Execution Information

| Field | Content |
|-------|---------|
| **Execution Date** | 2026-02-08 |
| **Execution Time** | 21:49:48 |
| **Script Version** | smoke-all.sh v1.0 |
| **Total Duration** | ~93 seconds |

---

## Conclusion

❌ **Some tests failed.** Please review the error logs above and check:
- MLX server is running: `bash scripts/mlx-lab/check-health.sh`
- Model path is correct: `MLX_MODEL_PATH` environment variable
- Server logs: `tail -f /tmp/mlx-lm-server.log`

---
*Generated by msgcode MLX smoke test automation*
