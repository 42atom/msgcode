# MLX Smoke Test Report

> Automated smoke test execution for MLX LM Server validation
>
> Generated: 2026-02-08 20:25:21

---

## Execution Summary

| Metric | Value |
|--------|-------|
| **Total Tests** | 5 |
| **Passed** | 2 |
| **Failed** | 3 |
| **Pass Rate** | 40% |

---

## Test Details


### Start MLX Server

| Field | Content |
|-------|---------|
| **Test Name** | Start MLX Server |
| **Script** | `start-server.sh` |
| **Rounds** | N/A |
| **Expected Behavior** | MLX server starts successfully and is ready to accept requests |
| **Status** | RUNNING |


**Result:** ✅ PASSED

```
启动 mlx_lm.server...
  模型路径: /Users/admin/Models/lmstudio/huihui-ai/Huihui-GLM-4.7-Flash-abliterated-mlx-4bit
  监听地址: 127.0.0.1:18000
  最大 tokens: 512
等待服务启动...

mlx_lm.server 启动成功!
  PID: 70845
  PID 文件: /tmp/msgcode-mlx-lab.pid
  日志文件: /tmp/msgcode-mlx-lab.log

健康检查: curl http://127.0.0.1:18000/v1/models
停止服务: bash scripts/mlx-lab/stop-server.sh
```


### Health Check

| Field | Content |
|-------|---------|
| **Test Name** | Health Check |
| **Script** | `check-health.sh` |
| **Rounds** | N/A |
| **Expected Behavior** | Server /v1/models endpoint returns 200 and valid model list |
| **Status** | RUNNING |


**Result:** ✅ PASSED

```
检查服务健康状态: http://127.0.0.1:18000/v1/models

服务健康检查通过!
  HTTP 状态: 200
  可用模型数: 2

模型列表:
  - openbmb/MiniCPM-o-4_5
  - /Users/admin/Models/lmstudio/huihui-ai/Huihui-GLM-4.7-Flash-abliterated-mlx-4bit
```


### Basic Response Test

| Field | Content |
|-------|---------|
| **Test Name** | Basic Response Test |
| **Script** | `probe-basic.sh` |
| **Rounds** | 5 |
| **Expected Behavior** | 5 rounds of simple prompts, each returning valid response (expected: 'OK') |
| **Status** | RUNNING |


**Result:** ❌ FAILED

```
探测模型 ID...
探测到模型: openbmb/MiniCPM-o-4_5
基础响应测试 (5 轮)
测试指令: 只输出 OK

[1/5] 失败: 响应格式无效
响应: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
```

**Error Log:**
```
探测模型 ID...
探测到模型: openbmb/MiniCPM-o-4_5
基础响应测试 (5 轮)
测试指令: 只输出 OK

[1/5] 失败: 响应格式无效
响应: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
```


### Tool Role Test

| Field | Content |
|-------|---------|
| **Test Name** | Tool Role Test |
| **Script** | `probe-tool-role.sh` |
| **Rounds** | 10 |
| **Expected Behavior** | 10 rounds testing tool role message handling and context preservation |
| **Status** | RUNNING |


**Result:** ❌ FAILED

```
探测模型 ID...
探测到模型: openbmb/MiniCPM-o-4_5
Tool Role 回灌测试 (10 轮)
测试: 模型应该只输出工具返回的值 (42)
参数: temperature=0.7 top_p=1 max_tokens=512

[1/10] 失败: 响应格式无效
[2/10] 失败: 响应格式无效
[3/10] 失败: 响应格式无效
[4/10] 失败: 响应格式无效
[5/10] 失败: 响应格式无效
[6/10] 失败: 响应格式无效
[7/10] 失败: 响应格式无效
[8/10] 失败: 响应格式无效
[9/10] 失败: 响应格式无效
[10/10] 失败: 响应格式无效

结果: tool_role_pass = 0/10

失败样本:
  [1] 响应格式无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [2] 响应格式无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [3] 响应格式无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
状态: 失败
```

**Error Log:**
```
探测模型 ID...
探测到模型: openbmb/MiniCPM-o-4_5
Tool Role 回灌测试 (10 轮)
测试: 模型应该只输出工具返回的值 (42)
参数: temperature=0.7 top_p=1 max_tokens=512

[1/10] 失败: 响应格式无效
[2/10] 失败: 响应格式无效
[3/10] 失败: 响应格式无效
[4/10] 失败: 响应格式无效
[5/10] 失败: 响应格式无效
[6/10] 失败: 响应格式无效
[7/10] 失败: 响应格式无效
[8/10] 失败: 响应格式无效
[9/10] 失败: 响应格式无效
[10/10] 失败: 响应格式无效

结果: tool_role_pass = 0/10

失败样本:
  [1] 响应格式无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [2] 响应格式无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [3] 响应格式无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
状态: 失败
```


### Tool Loop Test

| Field | Content |
|-------|---------|
| **Test Name** | Tool Loop Test |
| **Script** | `probe-tool-loop.sh` |
| **Rounds** | 10 |
| **Expected Behavior** | 10 rounds testing two-round tool call loop (assistant → tool → assistant) |
| **Status** | RUNNING |


**Result:** ❌ FAILED

```
探测模型 ID...
探测到模型: openbmb/MiniCPM-o-4_5
工具闭环测试 (10 轮)
测试: 模拟两轮工具调用闭环
参数: temperature=0.7 top_p=1 max_tokens=512

[1/10] 失败: 第1轮响应格式无效
[2/10] 失败: 第1轮响应格式无效
[3/10] 失败: 第1轮响应格式无效
[4/10] 失败: 第1轮响应格式无效
[5/10] 失败: 第1轮响应格式无效
[6/10] 失败: 第1轮响应格式无效
[7/10] 失败: 第1轮响应格式无效
[8/10] 失败: 第1轮响应格式无效
[9/10] 失败: 第1轮响应格式无效
[10/10] 失败: 第1轮响应格式无效

结果: tool_loop_pass = 0/10

失败样本:
  [1] 第1轮响应无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [2] 第1轮响应无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [3] 第1轮响应无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
状态: 失败
```

**Error Log:**
```
探测模型 ID...
探测到模型: openbmb/MiniCPM-o-4_5
工具闭环测试 (10 轮)
测试: 模拟两轮工具调用闭环
参数: temperature=0.7 top_p=1 max_tokens=512

[1/10] 失败: 第1轮响应格式无效
[2/10] 失败: 第1轮响应格式无效
[3/10] 失败: 第1轮响应格式无效
[4/10] 失败: 第1轮响应格式无效
[5/10] 失败: 第1轮响应格式无效
[6/10] 失败: 第1轮响应格式无效
[7/10] 失败: 第1轮响应格式无效
[8/10] 失败: 第1轮响应格式无效
[9/10] 失败: 第1轮响应格式无效
[10/10] 失败: 第1轮响应格式无效

结果: tool_loop_pass = 0/10

失败样本:
  [1] 第1轮响应无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [2] 第1轮响应无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
  [3] 第1轮响应无效: {"error": "[load_safetensors] Invalid json header length file /Users/admin/Models/models--openbmb--MiniCPM-o-4_5/snapshots/ddb77e68098685b4419193fe205cd7a443d2fd60/model-00001-of-00004.safetensors"}
状态: 失败
```


---

## Execution Information

| Field | Content |
|-------|---------|
| **Execution Date** | 2026-02-08 |
| **Execution Time** | 20:25:43 |
| **Script Version** | smoke-all.sh v1.0 |
| **Total Duration** | ~22 seconds |

---

## Conclusion

❌ **Some tests failed.** Please review the error logs above and check:
- MLX server is running: `bash scripts/mlx-lab/check-health.sh`
- Model path is correct: `MLX_MODEL_PATH` environment variable
- Server logs: `tail -f /tmp/mlx-lm-server.log`

---
*Generated by msgcode MLX smoke test automation*
