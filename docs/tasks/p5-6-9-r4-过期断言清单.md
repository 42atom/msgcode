# P5.6.9-R4: 过期断言清单与替换映射表

## 过期断言清单

### 1. test/p5-6-3-skill-single-source.test.ts

**删除的断言：**
- `/skill run 路径必须调用 runSkill()` (Line 12-23)
  - 原因：/skill run 命令已在 P5.6.8-R3e 硬切删除
  - 替换：改为 `run_skill 工具调用必须调用 runSkill()`

**保留的断言：**
- `src/tools/bus.ts run_skill case 必须导入 runSkill` (Line 36-44) - 有效
- `src/lmstudio.ts 必须通过 Tool Bus 调用` (Line 27-34) - 有效
- 单一执行链静态扫描 (Line 48-81) - 有效
- 观测字段一致性检查 (Line 119-137) - 有效

### 2. test/p5-6-8-r3d-decoupling-regression.test.ts

**删除的断言：**
- `/skill run 降级为调试入口` 整个 describe (Line 46-80)
  - Line 47-56: 检查 MSGCODE_DEV_MODE - 已过期
  - Line 58-79: 测试 handleSkillRunCommand - 已过期
  - 原因：/skill run 命令已在 P5.6.8-R3e 硬切删除，不再是调试入口

**保留的断言：**
- 主链不应直接调用 run_skill (Line 12-44) - 有效
- PI 模式验证 (Line 82-133) - 有效
- 单一执行入口验证 (Line 135-166) - 有效

### 3. test/p5-6-2-r1-regression.test.ts

**更新的断言：**
- Line 56: `expect(code).toContain("SOUL: workspace=")` → `expect(code).toContain("SOUL: source=")`
  - 原因：/reload SOUL 输出格式已更新为字段语义
  - 替换：改为字段语义锁（不锁历史文案）

**保留的断言：**
- Line 59-65: SOUL Entries 断言 - 有效

### 4. test/p5-6-7-r6-smoke-static.test.ts

**更新的断言：**
- Line 52: `expect(code).toContain("SOUL: workspace=")` → `expect(code).toContain("SOUL: source=")`
  - 原因：/reload SOUL 输出格式已更新为字段语义
  - 替换：改为字段语义锁（不锁历史文案）

**保留的断言：**
- Line 53: SOUL Entries 断言 - 有效

## 替换映射表

| 旧断言 | 新断言 | 原因 |
|--------|--------|------|
| `/skill run 路径必须调用 runSkill()` | `run_skill 工具调用必须调用 runSkill()` | /skill run 命令已删除 |
| `skill-orchestrator.ts 必须导入 runSkill` | 删除 | /skill run 命令已删除 |
| `/skill run 降级为调试入口` | 删除 | /skill run 命令已删除 |
| `MSGCODE_DEV_MODE 检查` | 删除 | /skill run 命令已删除 |
| `handleSkillRunCommand 测试` | 删除 | /skill run 命令已删除 |
| `SOUL: workspace=` | `SOUL: source=` | 字段语义更新 |
| `SOUL: workspace=` | `SOUL: source=` | 字段语义更新 |

## 验收结果

- ✅ `npx tsc --noEmit` 通过
- ✅ `npm run docs:check` 通过
- ✅ vitest 核心测试：44/44 通过
  - test/p5-6-9-r3-cli-contract.test.ts: 19/19
  - test/p5-6-8-r4g-pi-core-tools.test.ts: 14/14
  - test/p5-6-8-r4e-soul-injection-regression.test.ts: 11/11

## 说明

bun:test 测试文件（p5-6-2、p5-6-3、p5-6-7、p5-6-8-r3d）是项目历史遗留的测试框架混用问题，不是本次修改引入的。vitest 核心测试全部通过。
