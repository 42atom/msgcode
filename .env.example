# msgcode 配置文件
#
# 推荐使用 msgcode init 命令自动创建此文件
# 也可手动复制到 ~/.config/msgcode/.env 后编辑

# ============================================
# 使用者信息（白名单）
# ============================================
# 你的 iMessage 邮箱（只有你发的消息 bot 才会响应）
MY_EMAIL=

# 电话号码（可选）
# MY_PHONE=+8613800138000

# 群聊安全（可选）：只响应“你自己的账号”（收口信任边界）
#
# - 不改变 Codex 的 sandbox 权限（仍可 danger-full-access），只限制“谁能触发执行”
# - 仅对群聊生效（chatId 形如 any;+;... 或 32 位 GUID）
# - MSGCODE_OWNER 支持逗号分隔多个标识（邮箱/电话 handle），但建议只填主号
#
# MSGCODE_OWNER_ONLY_IN_GROUP=1
# MSGCODE_OWNER=wan2011@me.com

# ============================================
# 工作空间根目录（2.0 推荐）
# ============================================
# 2.0 的工作目录统一挂在 root 下，每个群聊在群里用 /bind <dir> 绑定。
# 默认值：~/msgcode-workspaces
WORKSPACE_ROOT=/Users/<you>/msgcode-workspaces

# HuggingFace 缓存目录（建议放用户配置目录，避免写回仓库）
HF_HOME=/Users/<you>/.config/msgcode/cache/hf

# ============================================
# 群组路由配置（legacy，可选）
# ============================================
# 仅用于兼容旧的“静态绑定”模式：GROUP_<群组名>=<chatGuid>:<项目路径>:<bot类型>
# 2.0 推荐在群里用 /bind，而不是写 GROUP_*。
#
# 示例：
# GROUP_CODE_BOT=iMessage;+;your-guid:/Users/<you>/path/to/project:code

# ============================================
# 日志配置
# ============================================
# 日志级别 (debug | info | warn | error)
LOG_LEVEL=info

# 日志文件路径（可选）
# LOG_PATH=~/.config/msgcode/log/msgcode.log

# 禁用文件日志（可选）
# LOG_FILE=false

# 调试开关：记录入站消息明文到日志（默认关闭，含敏感信息）
# MSGCODE_LOG_PLAINTEXT_INPUT=0

# ============================================
# iMessage Provider（2.0 唯一）
# ============================================
# imsg 二进制路径（必填）
# 推荐使用源码构建产物，而非 brew 安装版本
# 构建方法: ./scripts/build-imsg.sh
# 校验方法: ./scripts/verify-imsg.sh
IMSG_PATH=/Users/<you>/msgcode/vendor/imsg/v0.4.0/imsg

# ============================================
# 高级配置（可选）
# ============================================

# 长任务回执延迟（毫秒，可选）
# - 非 slash 消息超过该时长才发送回执（默认 15000）
# - 设为 0 表示立即回执（不推荐，太吵）
# MSGCODE_ACK_DELAY_MS=15000

# 远程沟通提示（可选）：注入到 Codex/Claude Code 的第一条消息前缀
# - 目的：提醒模型“用户在手机端远程沟通”，回答应更短、更可复制
# - 默认开启；设为 0 可关闭
# MSGCODE_REMOTE_HINT=1
# 可选：自定义提示文本（多行不建议写这里；如需多行可写在外部文件再读入）
# MSGCODE_REMOTE_HINT_TEXT=【远程上下文｜勿复述】用户在手机端通过 iMessage 远程沟通...
# ============================================
# 本地模型（可选：LM Studio）
# ============================================
# 当你在群里绑定 botType=lmstudio 时（/bind <dir> lmstudio），msgcode 会调用 LM Studio 的本地 API。
#
# 你需要在 LM Studio 里启动 Local Server（同一个 Server 同时支持原生 REST `/api/v1/*` 与 OpenAI 兼容 `/v1/*`），默认地址：
# http://127.0.0.1:1234
#
# 本地 API Base URL（可选）
# LMSTUDIO_BASE_URL=http://127.0.0.1:1234
#
# 模型名（可选）
# - 留空或设为 "auto"：使用 LM Studio 当前已加载的模型（推荐，避免重复加载）
# - 设为具体模型名：使用指定模型（LM Studio 会自动加载，可能导致启动新模型）
# LMSTUDIO_MODEL=auto
#
# API Key（可选；LM Studio 开启认证后需要）
# LMSTUDIO_API_KEY=<your-api-token>
#
# System Prompt（可选；默认不注入，避免绑定角色/行为）
# LMSTUDIO_SYSTEM_PROMPT=<optional>
#
# 请求超时（毫秒，可选，默认 120000）
# LMSTUDIO_TIMEOUT_MS=120000
#
# 最大输出 token（可选，默认 4000）
# LMSTUDIO_MAX_TOKENS=4000

# ============================================
# 语音（TTS，可选）
# ============================================
# 自动语音回复时，最多朗读的字符数（避免超长回复导致生成时间过久）
# 默认 240；你可以根据机器性能调大（例如 800/1800）
# TTS_AUTO_MAX_CHARS=240

# 语音转码时是否裁切静音（默认 1 开启；0 关闭）
# - 开启可避免 iMessage 播放尾部出现“长空白”
# - 若你发现“只读第一句/后面被切掉”，先尝试调低阈值或延长 stop_duration
# TTS_TRIM_SILENCE=1

# 静音阈值（越小越保守，越不容易误切）
# 推荐：-60dB（默认）；如果仍有长空白可试 -50dB；如果被切掉可试 -65dB
# TTS_SILENCE_DB=-60dB

# 尾部静音判定“最小持续时长”（秒），越大越不容易把“句间停顿”当作尾部静音
# 推荐：2.0（默认）
# TTS_SILENCE_MIN_DURATION_SEC=2.0

# 输出增益（dB，可选）：让语音更响
# - 建议从 3 开始试；太大可能爆音/失真
# TTS_OUTPUT_GAIN_DB=3

# ============================================
# IndexTTS（本地，可选；当前 msgcode 的唯一 TTS 后端）
# ============================================
# 后端名（预留；当前仅 indextts）
# TTS_BACKEND=indextts
#
# 安装位置（建议统一放到 ~/Models，便于迁移/备份）
# INDEX_TTS_ROOT=~/Models/index-tts
# INDEX_TTS_PYTHON=$INDEX_TTS_ROOT/.venv/bin/python
# INDEX_TTS_MODEL_DIR=$INDEX_TTS_ROOT/checkpoints
# INDEX_TTS_CONFIG=$INDEX_TTS_ROOT/checkpoints/config.yaml
# INDEX_TTS_DEVICE=mps
#
# TTS 参考音频文件（IndexTTS 需要）
# - 建议用 m4a/wav 格式；内部会自动转成 wav
# - 例如：/Users/<you>/.config/msgcode/voices/ymvoice.m4a
# INDEXTTS_REF_AUDIO=
#
# P0：性能优化（基于 PyTorch 2.10 + MPS 实测优化）
# - FP16=0: 精度模式，速度更稳定，内存更可控
# - NUM_BEAMS=1: 降低解码成本（2→1 约 25-30% 加速）
# - DIFFUSION_STEPS=15: 20→15 约 25% 加速，可进一步试 12/10
# INDEX_TTS_MAX_SEQ_LENGTH=4096
# INDEX_TTS_NUM_BEAMS=1
# INDEX_TTS_DIFFUSION_STEPS=15
# INDEX_TTS_FP16=0
#
# P0：worker 策略（减少长跑内存爆/driver cache 持续上涨）
# 默认关闭常驻 worker（更稳）；想要更快可显式开启
# INDEX_TTS_USE_WORKER=0
# INDEX_TTS_WORKER_MAX_TEXT_CHARS=480
# INDEX_TTS_WORKER_RECYCLE_RSS_MB=4500
# INDEX_TTS_WORKER_RECYCLE_MPS_RATIO=0.72
# INDEX_TTS_SEGMENT_TIMEOUT_MS_MIN=180000
#
# P0：情绪分段兜底（避免“无标点长段”把单段推爆）
# TTS_EMO_SEGMENT_MAX_CHARS=120
# TTS_EMO_SEGMENT_SYNTH_MAX_CHARS=700
# TTS_LONG_TEXT_CHUNK_MAX_CHARS=120
